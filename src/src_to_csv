import pandas as pd
import re 

#PARSING
data = []

with open("data/raw/captions.txt", "r", encoding="utf-8") as f:
    next(f)  # skip header
    for line in f:
        parts = line.strip().split(",", 1)
        if len(parts) == 2:
            filename, caption = parts
            data.append([filename.strip(), caption.strip()])

df = pd.DataFrame(data, columns=["image_filename", "caption_desc"])
df.to_csv("data/raw/dataset.csv", index=False)

print(df.head())
print("SUCCESS: CSV created!")


#CLEANING
# Load dataset 
df = pd.read_csv("data/raw/dataset.csv")

def clean_caption(text):
    if pd.isna(text):
        return ""
    
    # lowercase
    text = text.lower()
    # hapus kutip
    text = text.replace('"', '')
    # hapus spasi berlebih
    text = re.sub(r'\s+', ' ', text).strip()
    
    return text

df["caption_desc"] = df["caption_desc"].apply(clean_caption)
df.to_csv("data/raw/dataset_clean.csv", index=False)

print(df.head())
print("SUCCESS: dataset_clean.csv created!")
print("Hai")
print("test")
